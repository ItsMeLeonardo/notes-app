import{j as m,R as y,r as l,a as f,P as p,b as k}from"./vendor.e6611811.js";const q=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}};q();const r=m.exports.jsx,d=m.exports.jsxs,A=m.exports.Fragment,x=y.createContext();function C({children:e}){const[t,a]=l.exports.useState(()=>{const s=localStorage.getItem("notes");return s?JSON.parse(s):null});return r(x.Provider,{value:{notes:t,setNotes:a},children:e})}function I(){return r("nav",{children:r("h1",{children:"Notes"})})}const h="/api/notes";let g=null;const D=e=>{g=`bearer ${e}`},U=async()=>(await f.get(h)).data,T=async e=>{const t={headers:{Authorization:g}};return await(await f.post(h,e,t)).data},O=async(e,t)=>{const a={headers:{Authorization:g}};return await(await f.put(`${h}/${e}`,t,a)).data},v=()=>{const{notes:e,setNotes:t}=l.exports.useContext(x);l.exports.useEffect(()=>{e||U().then(t)},[]);const a=l.exports.useCallback(n=>{T(n).then(o=>{t(i=>[...i,o])})},[t]),s=l.exports.useCallback(({id:n,newNote:o})=>{O(n,o).then(i=>{t(c=>c.map(u=>u.id===n?i:u))})},[t]);return{notes:e,saveNote:a,updateNote:s,getToken:D}};function w({content:e}){return r("li",{children:e})}var j=y.memo(w,(e,t)=>e.content===t.content);w.propTypes={content:p.string.isRequired};function F(){const{notes:e}=v(),[t,a]=l.exports.useState(!0),s=t?e:e.filter(o=>o.important);return d(A,{children:[r("button",{type:"button",onClick:()=>a(o=>!o),children:t?"Show Important":"Show All"}),r("ul",{children:s==null?void 0:s.map(({id:o,content:i})=>r(j,{content:i},o))})]})}const b=l.exports.forwardRef(({children:e,buttonLabel:t},a)=>{const[s,n]=l.exports.useState(!1),o={display:s?"none":""},i={display:s?"":"none"},c=()=>n(!s);return l.exports.useImperativeHandle(a,()=>({toggleVisibility:c})),d("div",{children:[r("button",{type:"button",onClick:c,style:o,children:t}),d("div",{style:i,children:[e,r("button",{type:"button",onClick:c,children:"Cancel"})]})]})});b.propTypes={children:p.node.isRequired,buttonLabel:p.string.isRequired};function S({token:e,logout:t}){const a=l.exports.useRef(null),s=l.exports.useRef(null),{saveNote:n,getToken:o}=v();return d(b,{buttonLabel:"Add note",ref:s,children:[d("form",{ref:a,onSubmit:c=>{c.preventDefault();const L={content:new FormData(a.current).get("note"),important:!0};a.current.firstChild.value="",o(e),n(L),s.current.toggleVisibility()},children:[r("input",{name:"note",placeholder:"Write your note here"}),r("input",{type:"submit",value:"add note"})]}),r("button",{type:"button",onClick:t,children:"Logout"})]})}S.propTypes={token:p.string.isRequired,logout:p.func.isRequired};const P="/api/login",$=async({username:e,password:t})=>{const{data:a}=await f.post(P,{username:e,password:t});return a};var V={login:$};function N({message:e}){return r("p",{children:e})}N.propTypes={message:p.string.isRequired};function R({saveUser:e}){const[t,a]=l.exports.useState(!1),s=l.exports.useRef(null);return r(b,{buttonLabel:"Show Login form",children:d("form",{onSubmit:o=>{o.preventDefault();const i=new FormData(s.current),c={username:i.get("username"),password:i.get("password")};V.login(c).then(u=>{e(u),sessionStorage.setItem("sessionUser",JSON.stringify(u))}).catch(u=>{a(u.response.data),sessionStorage.clear(),setTimeout(()=>{a(!1)},2500)})},ref:s,children:[r("label",{htmlFor:"username",children:r("input",{id:"username",name:"username",type:"text",placeholder:"Username"})}),r("label",{htmlFor:"password",children:r("input",{id:"password",name:"password",placeholder:"password",type:"password"})}),t&&r(N,{message:t.error}),r("button",{type:"submit",id:"login-button",children:"Login"})]})})}R.propTypes={saveUser:p.func.isRequired};function E(){const[e,t]=l.exports.useState(()=>{const s=sessionStorage.getItem("sessionUser");return s?JSON.parse(s):null}),a=()=>{t(null),sessionStorage.removeItem("sessionUser")};return d("div",{className:"App",children:[r(I,{}),d(C,{children:[e?r(S,{token:e.token,logout:a}):r(R,{saveUser:t}),r(F,{})]})]})}k.render(r(E,{}),document.getElementById("root"));
